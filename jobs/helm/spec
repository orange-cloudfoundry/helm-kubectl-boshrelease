---
name: helm

templates: 
  bin/run.erb: bin/run
  bin/chart.rb.erb: bin/chart.rb
  bin/repository.rb.erb: bin/repository.rb
  config/rbac-config.yaml.erb: config/rbac-config.yaml
  config/ca_cert.pem.erb: config/ca_cert.pem
  
packages: 
- helm
- kubectl
- ruby-2.4-r4

properties:
  director.name:
     description: "Name of director"
     example: "bosh-kubo"
     default: "bosh-kubo"

  deployment.name:
     description: "Name of deployment"
     example: "cfcr"
     default: "cfcr"

  kubernetes.host:
    description: "The hostname (in form of URI) of Kubernetes master"
    example: "cfcr-api.internal.paas"

  kubernetes.port:
    description: "The port of Kubernetes master"
    example: "443"

  kubernetes.password:
    description: "The password to use for HTTP basic authentication when accessing the Kubernetes master endpoint."

  kubernetes.cluster_ca_certificate:
    description: "PEM-encoded root certificates bundle for TLS authentication."

  service_account:
    description: "Service account to install Tiller with."
    default: "tiller"

  repositories:
    description: "array of helm repository in json format"
    example: |
      - name: 'stable'
        url: 'https://kubernetes-charts.storage.googleapis.com/'
      - name: 'incubator'
        url : 'https://kubernetes-charts-incubator.storage.googleapis.com'

    default:
      - name: 'stable'
        url: 'https://kubernetes-charts.storage.googleapis.com/'

  charts:
    description: "array of helm chart in json format defined by his name, his chart and an array of properties"
    example: |
      - name: 'mygrafana'
        chart: 'stable/grafana'
        namespace: 'default'
        properties:
          - name: 'service.type'
            value: 'ClusterIP'
          - name: 'service.port'
            value: '9000'
      - name: 'mygrafana2'
        chart: 'stable/grafana'
        namespace: 'default'
        properties:
          - name: 'service.type'
            value: 'ClusterIP'
          - name: 'service.port'
            value: '9001'
    default: []
  ingress:
    description: "array of ingress rules that need to be apply"
    example: |
      - name: dashboard-ingress
        namespace: kube-system
        spec:
          rules:
          - host: ingress-ops.nd-int-cfapi.itn.intraorange
            http:
              paths:
              - backend:
                  serviceName: kubernetes-dashboard
                  servicePort: 443
                path: /dashboard

      - name: grafana-ingress
        namespace: kube-system
        spec:
          rules:
          - host: ingress-ops.nd-int-cfapi.itn.intraorange
            http:
              paths:
              - backend:
                  serviceName: grafana
                  servicePort: 443
                path: /grafana

    default: []