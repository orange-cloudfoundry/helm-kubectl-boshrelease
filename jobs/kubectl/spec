---
name: kubectl

templates: 
  bin/run.erb: bin/run
  bin/set_env.erb: bin/set_env
  bin/apply.rb.erb: bin/apply.rb
  bin/secrets.rb.erb: bin/secrets.rb
  bin/namespaces.rb.erb: bin/namespaces.rb
  bin/delete_namespaces.rb.erb: bin/delete_namespaces.rb
  bin/ingress.rb.erb: bin/ingress.rb
  config/ca_cert.pem.erb: config/ca_cert.pem
  bin/pre-stop.erb: bin/pre-stop
  
packages: 
- kubectl
- ruby-2.4-r4

properties:

  proxy.https:
    description: "URL of https proxy"
    example: "http://myproxy.domain.com:8128"
    default: ""

  proxy.http:
    description: "URL of http proxy"
    example: "http://myproxy.domain.com:8128"
    default: ""

  proxy.noproxy:
    description: "list of no proxy"
    example: "127.0.0.1, localhost, *.internal.paas"
    default: ""

  kubernetes.host:
    description: "The hostname (in form of URI) of Kubernetes master"
    example: "cfcr-api.internal.paas"

  kubernetes.port:
    description: "The port of Kubernetes master"
    example: "443"

  kubernetes.usecontext:
    description: "say witch context use inside .kube/config"
    default: "cfcr"

  kubernetes.config_path:
    description: "use this parameter only if  .kube/config file is already defined in the vm at this path"
    default: ""

  kubernetes.password:
    description: "The password to use for HTTP basic authentication when accessing the Kubernetes master endpoint."

  kubernetes.cluster_ca_certificate:
    description: "PEM-encoded root certificates bundle for TLS authentication."

  kubernetes.default_storageclass:
    description: "If defined  put the default attribute to the storage class object"

  commands:
    description: "array of commands in yaml format command can be apply / patch "
    example: |
      - name: 'apply-test'
        cmd: 'apply'
        options: ''
        namespace: 'kube-system'
        apply: 'content of yaml file'
    default: []
  ingress_class:
    description: "select the kubernetes.io/ingress.class"
    example: "traefik"
    default: "nginx"
  ingress:
    description: "array of ingress rules that need to be apply"
    example: |
      - name: dashboard-ingress
        namespace: kube-system
        spec:
          rules:
          - host: ingress-ops.nd-int-cfapi.itn.intraorange
        http:
          paths:
          - backend:
          serviceName: kubernetes-dashboard
        servicePort: 443
        path: /dashboard

      - name: grafana-ingress
        namespace: kube-system
        spec:
          rules:
          - host: ingress-ops.nd-int-cfapi.itn.intraorange
            http:
              paths:
              - backend:
                  serviceName: grafana
                  servicePort: 443
                path: /grafana
    default: []
  namespaces:
    description: "array of namespace that need to be created"
    default: []

  secrets:
    description: "array of secret that need to be apply, each entry will be base64 encoded automatically"
    example: |
      - name: cert-secret
        namespace: mynamespace
        data: # defines the data map see https://kubernetes.io/docs/concepts/configuration/secret/#creating-a-secret-manually
          - name: keyname
          - value: keyvalue (not in B 64)
      - name: cert2-secret
         namespace: mynamespace
         data:
          - name: another-keyname
          - value: another-keyvalue (not in B 64)
    default: []
